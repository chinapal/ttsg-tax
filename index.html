<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CN/SG Tax Calculator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f7f9fc;
        }
        .container {
            background: #ffffff;
            padding: 20px;
            box-sizing: border-box;
        }
        h1 {
            font-size: 1.8rem;
            margin-top: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }
        label {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .result {
            font-size: 80%;
            margin: 20px -20px;
            font-size: 1rem;
            color: #444;
            text-align: left;
            background-color: #f0f8ff;
            border-radius: 5px;
            padding: 5px 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .result span {
            font-weight: bold;
            color: #333;
        }
        .references {
            margin-top: 20px;
        }
        .references ul {
            list-style-position: inside;
            padding-left: 0;
            list-style: none;
        }
        .references ul li {
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CN/SG Tax Calculator</h1>

        <div class="result">
          <p>Tax deductions, CPF, and similar factors are not included.</p>
          <p>Generated by GPT; not legally accurate. Use with caution.</p>
          <p>Calculations are performed in your browser and are not sent anywhere.
          Source code: <a href="https://github.com/chinapal/ttsg-tax">chinapal/ttsg-tax</a></p>
        </div>

        <label for="monthlyPay">* Monthly Base Salary (cash, in SGD):</label>
        <input type="number" id="monthlyPay" value="10000" step="1" oninput="calculateTax()">

        <label for="bonusMonths">Target Bonus (in months):</label>
        <input type="number" id="bonusMonths" value="3" step="1" oninput="calculateTax()">
        
        <label for="rsuSold">* RSU Sold (counts toward total income, in SGD):</label>
        <input type="number" id="rsuSold" value="50000" step="1" oninput="calculateTax()">

        <label for="compensationPercentage">* Your Tax Compensation (%):</label>
        <input type="number" id="compensationPercentage" value="10" step="0.1" oninput="calculateTax()">

        <label for="exchangeRate">Exchange Rate (SGD to CNY):</label>
        <input type="number" id="exchangeRate" value="5.39" step="0.01" oninput="calculateTax()">

        <p>If you're both China & Singapore tax resident:</p>
        <div class="result" id="result">
            <p>Cash Income: <span class="amount" id="cashIncome"></span></p>
            <p>Tax Comp.: <span class="amount" id="compensation"></span></p>
            <p>Total Income <sup>[1]</sup>: <span class="amount" id="totalIncome"></span></p>
            <p>Total Tax <sup>[2]</sup>: <span class="amount" id="totalTax"></span></p>
            <p>SG Tax: <span class="amount" id="sgTax"></span></p>
            <p>CN Tax: <span class="amount" id="cnTax"></span></p>
            <p>After Tax: <span class="amount" id="afterTax"></span></p>
        </div>

        <p>If you're Singapore tax resident only:</p>
        <div class="result" id="result">
            <p>Total Income: <span class="amount" id="sgTotalIncome"></span></p>
            <p>SG Tax <sup>[3]</sup>: <span id="sgTaxOnly"></span></p>
            <p>After Tax: <span class="amount" id="sgAfterTax"></span></p>
            <p>After Tax Diff: <span id="afterTaxDiff"></span></p>
        </div>

        <p>References</p>
        <div class="references result">
          <ul>
            <li>[1]: Total Income = total package + tax compensation</li>
            <li>[2]: CN tax rate <a href="https://cw.nwu.edu.cn/info/1009/2474.htm">https://cw.nwu.edu.cn/...</a></li>
            <li>[3]: SG tax rate <a href="https://www.iras.gov.sg/taxes/individual-income-tax/basics-of-individual-income-tax/tax-residency-and-tax-rates/individual-income-tax-rates">https://www.iras.gov.sg/...</a></li>
          </ul>
        </div>
    </div>

    <script>
        // Singapore tax brackets
        const sgTaxBrackets = [
            { upTo: 20000, rate: 0, baseTax: 0 },
            { upTo: 30000, rate: 0.02, baseTax: 0 },
            { upTo: 40000, rate: 0.035, baseTax: 200 },
            { upTo: 80000, rate: 0.07, baseTax: 550 },
            { upTo: 120000, rate: 0.115, baseTax: 3350 },
            { upTo: 160000, rate: 0.15, baseTax: 7950 },
            { upTo: 200000, rate: 0.18, baseTax: 13950 },
            { upTo: 240000, rate: 0.19, baseTax: 21150 },
            { upTo: 280000, rate: 0.195, baseTax: 28750 },
            { upTo: 320000, rate: 0.20, baseTax: 36550 },
            { upTo: 500000, rate: 0.22, baseTax: 44550 },
            { upTo: 1000000, rate: 0.23, baseTax: 84150 },
            { upTo: Infinity, rate: 0.24, baseTax: 199150 },
        ];
        
        // China tax brackets
        const cnTaxBrackets = [
            { upTo: 60000, rate: 0, reduct: 0 },
            { upTo: 36000 + 60000, rate: 0.03, reduct: 0 },
            { upTo: 144000 + 60000, rate: 0.10, reduct: 2520 },
            { upTo: 300000 + 60000, rate: 0.20, reduct: 16920 },
            { upTo: 420000 + 60000, rate: 0.25, reduct: 31920 },
            { upTo: 660000 + 60000, rate: 0.30, reduct: 52920 },
            { upTo: 960000 + 60000, rate: 0.35, reduct: 85920 },
            { upTo: Infinity, rate: 0.45, reduct: 181920 }
        ];

        // Helper function to format both SGD and CNY with commas
        function formatCurrencyCN(cnyValue, exchangeRate) {
            const sgdValue = cnyValue / exchangeRate;
            return formatCurrencies(sgdValue, cnyValue);
        }
        function formatCurrencySG(sgdValue, exchangeRate) {
            const cnyValue = sgdValue * exchangeRate;
            return formatCurrencies(sgdValue, cnyValue);
        }
        function formatCurrencies(sgdValue, cnyValue) {
            const format = (value) => value.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            return `$${format(sgdValue)} / Â¥${format(cnyValue)}`;
        }

        // Calculate progressive tax
        function calculateProgressiveTax(income, taxBrackets) {
            let tax = 0;
            for (let i = 1; i < taxBrackets.length; i++) {
                const curr = taxBrackets[i], prev = taxBrackets[i - 1];
                const inRange = Math.min(curr.upTo, income) - prev.upTo;
                if (inRange > 0) {
                    tax += inRange * curr.rate;
                }
            }
            return tax;
        }

        // Main calculation logic
        function calculateTax() {
            const monthlyPay = parseFloat(document.getElementById('monthlyPay').value);
            const bonusMonths = parseFloat(document.getElementById('bonusMonths').value);
            const rsuSold = parseFloat(document.getElementById('rsuSold').value);
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
            const compensationPercentage = parseFloat(document.getElementById('compensationPercentage').value) / 100;

            if (!monthlyPay || rsuSold < 0 || exchangeRate <= 0 || bonusMonths < 0 || compensationPercentage < 0 || compensationPercentage > 1) {
                for (const el of document.querySelectorAll('.amount')) el.innerText = formatCurrencySG(0, exchangeRate);
                return;
            }

            const cashPart = monthlyPay * (12 + bonusMonths);
            const compensation = cashPart * compensationPercentage;
            const totalPackage = cashPart + rsuSold
            const totalIncome = totalPackage + compensation;

            // Calculating Singapore and China taxes
            const sgTax = calculateProgressiveTax(totalIncome, sgTaxBrackets);
            const totalTaxInCNY = calculateProgressiveTax(totalIncome * exchangeRate, cnTaxBrackets);
            const sgTaxInCNY = sgTax * exchangeRate;
            const cnSpecificTaxInCNY = totalTaxInCNY - sgTaxInCNY;
            const sgTaxOnlyInSGD = calculateProgressiveTax(totalPackage, sgTaxBrackets)
            const afterTaxInSGD = totalIncome - totalTaxInCNY / exchangeRate;
            const sgAfterTaxInSGD = totalPackage - sgTaxOnlyInSGD;
            const afterTaxDiff = sgAfterTaxInSGD - afterTaxInSGD;

            // Display results
            document.getElementById('cashIncome').innerText = formatCurrencySG(cashPart, exchangeRate);
            document.getElementById('compensation').innerText = formatCurrencySG(compensation, exchangeRate);
            document.getElementById('totalIncome').innerText = formatCurrencySG(totalIncome, exchangeRate);
            document.getElementById('sgTax').innerText = formatCurrencySG(sgTax, exchangeRate);
            document.getElementById('totalTax').innerText = formatCurrencyCN(totalTaxInCNY, exchangeRate);
            document.getElementById('cnTax').innerText = formatCurrencyCN(cnSpecificTaxInCNY, exchangeRate);
            document.getElementById('afterTax').innerText = formatCurrencySG(afterTaxInSGD, exchangeRate);

            document.getElementById('sgTotalIncome').innerText = formatCurrencySG(totalPackage, exchangeRate);
            document.getElementById('sgTaxOnly').innerText = formatCurrencySG(sgTaxOnlyInSGD, exchangeRate);
            document.getElementById('sgAfterTax').innerText = formatCurrencySG(sgAfterTaxInSGD, exchangeRate);
            document.getElementById('afterTaxDiff').innerText = formatCurrencySG(afterTaxDiff, exchangeRate);
        }

        // Initial calculation
        calculateTax();
    </script>
</body>
</html>
